const h=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function a(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=a(s);fetch(s.href,n)}};h();const m={articleDataArray:[],calendarData:{days:[],oldDaysBefore:[],oldDaysAfter:[],weekdays:[{text:"\u4E00"},{text:"\u4E8C"},{text:"\u4E09"},{text:"\u56DB"},{text:"\u4E94"},{text:"\u516D"},{text:"\u65E5"}],chooseDate:{year:2022,month:3}},axiosUrl:"https://tranquil-gorge-87619.herokuapp.com/",viewScroll:"",UI:{plusButton:{width:0,height:0},articlePlusShow:!0,appliedArea:"allItem",UIShow:!0,UIStyle:{allItem:"buttonMenuClick",toDo:"buttonMenuUnclick",getThingsDone:"buttonMenuUnclick",calendar:"buttonMenuUnclick"},loading:!0,itemButton:!1,articleShow:!1,articleForm:!1},form:{editArticleH2:"\u6DFB\u52A0\u4EE3\u8FA6\u4E8B\u9805",edit:!1,id:"",title:"",content:"",setDate:{},date:{}}},d=Vue.createApp({data(){return m},computed:{toDoData:function(){return this.articleDataArray.filter(function(e){return e.state===!1})},getThingsDoneData:function(){return this.articleDataArray.filter(function(e){return e.state===!0})},chooseDateRes:{get(){const e=this.calendarData.chooseDate.year,t=this.calendarData.chooseDate.month;return t>=10?`${String(e)}-${String(t)}`:`${String(e)}-0${String(t)}`},set(e){const t=e.target.value,a=parseInt(t.slice(0,4)),i=parseInt(t.slice(5,7));this.calendarDays(a,i),this.calendarData.chooseDate.year=a,this.calendarData.chooseDate.month=i}}},watch:{viewScroll:function(e,t){e>t&&this.UI.plusButton.width===0?(this.UI.plusButton.width=70,this.UI.plusButton.height=70):e<t&&this.UI.plusButton.width!==0&&(this.UI.plusButton.width=0,this.UI.plusButton.height=0)}},created:function(){this.$nextTick(async function(){const e=new Date,t=e.getFullYear(),a=e.getMonth()+1;this.calendarDays(t,a),this.calendarData.chooseDate.year=t,this.calendarData.chooseDate.month=a;const i=await axios.get(this.axiosUrl);this.UI.loading=!1,this.ajaxArticle(i.data)})},mounted(){const e=this;this.$nextTick(function(){window.innerWidth<1024?(e.UI.plusButton.width=70,e.UI.plusButton.height=70,window.addEventListener("scroll",function(){e.viewScroll=window.scrollY})):(e.UI.plusButton.width=200,e.UI.plusButton.height=60),console.log(this.$refs)})},methods:{buttonMenuStyle:function(e){switch(this.UI.UIStyle={allItem:"buttonMenuUnclick",toDo:"buttonMenuUnclick",getThingsDone:"buttonMenuUnclick",calendar:"buttonMenuUnclick"},e.target.outerText){case"\u6240\u6709\u4E8B\u9805":this.UI.articlePlusShow=!0,this.UI.UIStyle.allItem="buttonMenuClick";break;case"\u5F85\u8FA6":this.UI.articlePlusShow=!0,this.UI.UIStyle.toDo="buttonMenuClick";break;case"\u7D50\u6848":this.UI.articlePlusShow=!0,this.UI.UIStyle.getThingsDone="buttonMenuClick";break;case"\u884C\u4E8B\u66C6":this.UI.articlePlusShow=!1,this.UI.UIStyle.calendar="buttonMenuClick";break}},editArticle:function(e){const t=this;t.UI.articleForm=!0,t.form.edit=!0,t.form.editArticleH2="\u4FEE\u6539\u6E05\u55AE";for(const a of t.articleDataArray)if(a.id===e){t.form.id=a.id,t.form.title=a.title,t.form.content=a.content;break}},setArticleState:function(e,t,a){if(typeof e!="string"&&typeof t!="boolean"&&typeof a!="string")return;const i=this;for(const n of i.articleDataArray)if(n.id===e){if(n.state===t&&n.stateImg===a)return;n.state=t,n.stateImg=a;break}const s={id:e,state:t,stateImg:a};this.axiosSubmit("POST","chengeState",s)},removeArticle:function(e){this.axiosSubmit("DELETE","DELETE",{id:e})},articleState:function(e,t,a,i){const s=this.UI.UIShow,n=this.UI.itemButton,r=this.UI.articleShow;if(s===!0&&n===!1&&r===!1)this.UI.articlePlusShow=!1,this.UI.UIShow=!1,this.UI.articleShow=!0,this.form.editArticleH2="\u5F85\u8FA6\u4E8B\u9805";else if(s===!1&&n===!1&&r===!0){this.UI.articlePlusShow=!0,this.UI.UIShow=!0,this.UI.articleShow=!1,this.closeEditArticle();return}this.form.title=e,this.form.content=t,this.form.setDate=a,this.form.date=i},updataArticle:function(){const e=this,t=e.form.id,a=e.form.title,i=e.form.content,s=e.form.date,n={y:parseInt(s.slice(0,4)),m:parseInt(s.slice(5,7)),d:parseInt(s.slice(8))};for(const o of e.articleDataArray)if(o.id===t){o.title=a,o.content=i,o.date=n;break}const r={id:t,title:a,content:i,date:s};this.axiosSubmit("POST","reviseArticle",r),e.closeEditArticle()},formSubmit:function(){if(this.form.edit===!0){this.updataArticle();return}const e=this,t=new Date,a=this.uuid(),i=this.form.title,s=this.form.content,n=this.form.date,r={setY:parseInt(t.getFullYear()),setM:parseInt(t.getMonth()+1),setD:parseInt(t.getDate())};if(i===""||s===""||typeof n!="string")return;const o={y:parseInt(n.slice(0,4)),m:parseInt(n.slice(5,7)),d:parseInt(n.slice(8))};if(o.y<t.getFullYear()){alert("\u65E5\u671F\u4E0D\u80FD\u662F\u904E\u53BB");return}if(o.m<t.getMonth()+1){alert("\u65E5\u671F\u4E0D\u80FD\u662F\u904E\u53BB");return}else if(o.m===t.getMonth()+1&&o.d<t.getDate()){alert("\u65E5\u671F\u4E0D\u80FD\u662F\u904E\u53BB");return}r.setY=String(r.setY),r.setM=String(r.setM),r.setD=String(r.setD),r.setM.length===1&&(r.setM=`0${r.setM}`),r.setD.length===1&&(r.setD=`0${r.setD}`);const f=s.replace(/\r?\n/g,"<br>"),u={id:a,itemShow:!0,menu:!1,menuClass:"closeItem",state:!1,stateImg:"/images/close.png",title:i,content:f,setDate:`${r.setY}-${r.setM}-${r.setD}`,date:n};this.axiosSubmit("POST","addArticle",u),e.closeEditArticle()},closeEditArticle:function(){const e=this;setTimeout(function(){e.form.id="",e.form.title="",e.form.content="",e.form.date="",e.form.editArticleH2="\u6DFB\u52A0\u4EE3\u8FA6\u4E8B\u9805"},300),e.UI.articleForm=!1,e.form.edit=!1},ajaxArticle:function(e){const t=this,a=e.map(function(i){return i.setDate={setY:parseInt(i.setDate.slice(0,4)),setM:parseInt(i.setDate.slice(5,7)),setD:parseInt(i.setDate.slice(8))},i.date={y:parseInt(i.date.slice(0,4)),m:parseInt(i.date.slice(5,7)),d:parseInt(i.date.slice(8))},i});t.articleDataArray=[],a.forEach(function(i){t.articleDataArray[t.articleDataArray.length]=i})},axiosSubmit:async function(e,t,a){this.UI.loading=!0,axios({method:e,url:this.axiosUrl,data:{func:t,data:a}}).then(i=>{console.log(i),this.UI.loading=!1,console.log(i.data),this.ajaxArticle(i.data)})},uuid:function(){let e=Date.now();return typeof performance!="undefined"&&typeof performance.now=="function"&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){e=Math.floor(e/16);const a=(e+Math.random()*16)%16|0;return(t==="x"?a:a&3|8).toString(16)})},calendarDays:function(e,t){let a;const i=[],s=[],n=[];let o=new Date(e,t-1,1).getDay(),u=new Date(e,t-1,0).getDate(),l=NaN;t%2===0?t===2?(a=28,l=14):(a=30,l=12):(a=31,l=11),(e%400===0||e%4===0&&e%100!==0)&&t===2&&(a=29,l=13),o===0?(o=7,u-=6,l-=6):(u-=o-1,l-=o-2);for(let c=0;c<a;c++)i.push(c+1);for(let c=0;c<o;c++)s.push(u),u++;for(let c=0;c<l-2;c++)n.push(c+1);this.calendarData.days=i,this.calendarData.oldDaysBefore=s,this.calendarData.oldDaysAfter=n}}});d.component("article-box",{props:{articleData:{type:Object,required:!0},itemState:{type:Boolean,required:!0}},emits:["item-button-temp","item-class-temp","article-state-temp","set-article-state-temp","edit-article-temp","remove-article-temp"],data:function(){return{articleDatas:this.articleData,itemButtonState:this.itemState,articleSet:[{text:"\u5F85\u8FA6"},{text:"\u7D50\u6848"},{text:"\u4FEE\u6539"},{text:"\u522A\u9664"}]}},watch:{"articleData.menu"(e,t){this.articleDatas.menu=e},"articleData.menuClass"(e,t){this.articleDatas.menuClass=e},"articleData.state"(e,t){this.articleDatas.state=e},"articleData.stateImg"(e,t){this.articleDatas.stateImg=e},itemState(e,t){this.itemButtonState=e}},created(){},methods:{changeArticleState:function(e){const t=this.articleData.title,a=this.articleData.content,i=this.articleData.setDate,s=this.articleData.date;this.$emit("article-state-temp",t,a,i,s)},setItem:function(e){const t=this;t.itemButtonState===!1&&(t.$emit("item-button-temp",!0),t.$emit("item-class-temp","openItem"),window.addEventListener("mouseup",function a(){t.$emit("item-class-temp","closeItem"),window.removeEventListener("mouseup",a),t.$emit("item-button-temp",!1)}))},clickButton:function(e){const t=this;switch(e.srcElement.outerText){case"\u5F85\u8FA6":t.$emit("set-article-state-temp",t.articleDatas.id,!1,"/images/close.png");break;case"\u7D50\u6848":t.$emit("set-article-state-temp",t.articleDatas.id,!0,"/images/check.png");break;case"\u4FEE\u6539":t.$emit("edit-article-temp",t.articleDatas.id);break;case"\u522A\u9664":if(t.articleDatas.state===!1&&confirm("\u6B64\u6E05\u55AE\u5C1A\u672A\u7D50\u6848\uFF0C\u78BA\u5B9A\u8981\u522A\u9664\u55CE?")===!1)return;t.$emit("remove-article-temp",t.articleDatas.id);break}}},template:`
    
        
        <transition>
            <div v-if="articleDatas.itemShow" @click.self="changeArticleState"
                class="article d-flex flex-column justify-content-between text-start col-12 mb-3 px-3 pb-3">
                <div>

                    <h3 @click.self="changeArticleState" class="mb-4 px-1">{{articleDatas.title}}</h3>
                    <p @click.self="changeArticleState" v-html="articleDatas.content" class="px-1"></p>
                </div>
                <div class="itemList">

                    <button @click.stop="setItem" class="setButton" type="button">
                    </button>

                    <ul :class="articleDatas.menuClass" @click.stop="clickButton"
                        class="d-flex flex-column justify-content-center py-2 px-3">

                        <li v-for="item of articleSet">
                            <button>{{item.text}}</button>
                        </li>

                    </ul>
                </div>
                <div @click="changeArticleState" class="d-flex justify-content-around">

                    <div id="add" class="listState d-flex justify-content-center align-items-center">
                        <span>{{articleData.setDate.setM}}/{{articleData.setDate.setD}}</span>
                    </div>

                    <div class="listState">
                        <img :src="articleDatas.stateImg" alt="">
                    </div>

                    <div id="end" class="listState d-flex justify-content-center align-items-center">
                        <span>{{articleData.date.m}}/{{articleData.date.d}}</span>
                    </div>

                </div>


            </div>
        </transition>

    `});d.mount("#app");
